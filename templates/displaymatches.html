{% extends 'base.html' %}
{% block title%}
ReadMe: Recommendations
{% endblock %}
{% block content %}
<div class="container">

<div class="row main-content">
    <div class="col-md-8 col-md-offset-1 reading">
        <h2 class="title main"> {{ match_poem.title }}</h2>
        <h4 class="author main"> by {{ match_poem.poet.name }}</h4>
        <p><a href="{{match_poem.url}}">Read on The Poetry Foundation</a></p>
        <p><a href="/{{match_poem.poem_id}}/about">See Stats</a></p>
        {% if match_poem.title != main_poem.title %}
        <p><a href="/{{match_poem.poem_id}}">More Like This</a></p>
        {% endif %}
        <br>
        <div class="poem-content">
            {{ match_poem.formatted_text|safe }}
        </div>
    </div> <!-- end of first column -->
    <div class="col-md-2">

            {% if wikipedia_url %}
        <div class="wikipedia">
            <a href= {{ wikipedia_url }}>
            <img class="author-photo" src={{ source }}>
            <h6 class="learn-more">Read More About {{ match_poem.poet.name }}</h6>
            </a>
        </div>
            {% endif %}

        <div class="row results">
            <h5 class="title">
                <a href='/{{main_poem.poem_id}}/0'>{{ main_poem.title }}</a>
            </h5>
            <h6 class="author">By {{ main_poem.poet.name }}</h6>
            <p class="main-poem">Matched Poem</p>
        </div>

        <div class="row results">
            <h5>Best Recommendations:</h5>
            <p style="font-size:small">Select which recommendation you think is the best by selecting the heart next to its title.</p>
        </div>
        {% for poem, i in match_poems %}
        <div class="row results">
            <h5 class="title">
                <a href='/{{main_poem.poem_id}}/{{poem.poem_id}}'>
                    {{ poem.title }}
                </a>
            </h5>
            <h6 class="author">{{ poem.poet.name }}
            <img class="best-button {{ poem.poet.name }}" id="{{ poem.poem_id }}/{{i}}" src="../static/greyheart.png"></h6>
        </div>
        {% endfor %}

    </div> <!-- end of results column -->
</div> <!-- end of main-content row -->
</div> <!-- end of container div -->
<script>

var main_poem = {{ main_poem.poem_id }};

function success() {
    console.log("Success!");
}

function changeImage(evt) {
    $('.best-button').attr('src', '../static/greyheart.png');
    var information = evt.currentTarget.id;
    evt.currentTarget.src = '../static/blackheart.png';
    // send the id to a route to log it
    $.post('/feedback', {"main_poem": main_poem, "match_poem": information}, success);
    // $(".best-button").off('click');
}


{% if best_selected %}

    $(".{{ best_selected }}").attr('src', '../static/blackheart.png');

{% endif %}

$(".best-button").on('click', changeImage);


</script>
{% endblock %}
